'use strict';

(function () {
    function marcarLinkComoSelecionado(hash) {
        var links = document.querySelectorAll('[wm-link]');
        links.forEach(function (link) {
            return link.classList.remove('selecionado');
        });

        var link = document.querySelector('[wm-link=\'' + hash + '\']');
        link.classList.add('selecionado');
    }

    function navegarViaAjax(hash) {
        if (!hash) return;

        var link = document.querySelector('[wm-link=\'' + hash + '\']');
        var destino = document.querySelector('[wm-link-destino]');

        var url = hash.substring(1);
        fetch(url).then(function (resp) {
            return resp.text();
        }).then(function (html) {
            destino.innerHTML = html;
            marcarLinkComoSelecionado(hash);
        });
    }

    function configurarLinks() {
        document.querySelectorAll('[wm-link]').forEach(function (link) {
            link.href = link.attributes['wm-link'].value;
        });
    }

    function navegacaoInicial() {
        if (location.hash) {
            navegarViaAjax(location.hash);
        } else {
            var primeiroLink = document.querySelector('[wm-link]');
            navegarViaAjax(primeiroLink.hash);
        }
    }

    window.onhashchange = function (e) {
        return navegarViaAjax(location.hash);
    };

    configurarLinks();
    navegacaoInicial();
})();